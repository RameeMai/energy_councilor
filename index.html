<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能源顾问 - 基于DeepSeek API的智能助手</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.6;
            padding: 15px;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #1a6dfc 0%, #0cbcf5 100%);
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 12px rgba(12, 188, 245, 0.2);
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            font-size: 0.8rem;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .status-connected {
            background-color: #4CAF50;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px;
            border-radius: 15px;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: #1a6dfc;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .assistant-message {
            align-self: flex-start;
            background: white;
            color: #333;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 13px;
        }
        
        .user-avatar {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .assistant-avatar {
            background: linear-gradient(135deg, #0cbcf5 0%, #1a6dfc 100%);
            color: white;
        }
        
        .sender-name {
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .message-content {
            font-size: 1.1rem; /* 放大字体 */
            line-height: 1.6;
        }
        
        /* 格式化回答内容 */
        .message-content h3 {
            margin: 12px 0 8px 0;
            color: #1a6dfc;
            font-size: 1.2rem;
        }
        
        .message-content h4 {
            margin: 10px 0 6px 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .message-content ul, .message-content ol {
            margin: 8px 0 8px 18px;
        }
        
        .message-content li {
            margin-bottom: 6px;
        }
        
        .message-content p {
            margin-bottom: 10px;
        }
        
        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 1rem;
        }
        
        .message-content th, .message-content td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: left;
        }
        
        .message-content th {
            background-color: #f0f9ff;
            color: #1a6dfc;
            font-weight: bold;
        }
        
        .data-point {
            background: #f0f9ff;
            border-left: 4px solid #1a6dfc;
            padding: 8px 12px;
            margin: 10px 0;
            border-radius: 0 6px 6px 0;
            font-size: 1rem;
        }
        
        .thinking-indicator {
            display: flex;
            align-items: center;
            color: #666;
            font-style: italic;
        }
        
        .dots {
            display: inline-block;
            margin-left: 5px;
        }
        
        .dot {
            display: inline-block;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #666;
            margin: 0 2px;
            animation: pulse 1.5s infinite;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .input-area {
            padding: 12px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-top: 1px solid #e0e0e0;
            border-radius: 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }
        
        .input-container {
            display: flex;
            gap: 8px;
        }
        
        #user-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        
        #user-input:focus {
            border-color: #1a6dfc;
            box-shadow: 0 0 0 2px rgba(26, 109, 252, 0.1);
        }
        
        #send-btn {
            background: linear-gradient(135deg, #1a6dfc 0%, #0cbcf5 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(26, 109, 252, 0.3);
        }
        
        #send-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(26, 109, 252, 0.3);
        }
        
        .suggested-questions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
        }
        
        .question-chip {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 8px 16px;
            border-radius: 18px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            max-width: 200px;
            text-align: center;
        }
        
        .question-chip:hover {
            background: #f0f9ff;
            border-color: #1a6dfc;
            color: #1a6dfc;
        }
        
        .highlight {
            color: #1a6dfc;
            font-weight: bold;
        }
        
        /* 16:9横屏适配 */
        @media (min-aspect-ratio: 16/9) {
            body {
                max-width: 1600px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .header {
                margin-bottom: 20px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .chat-container {
                gap: 20px;
                padding: 15px;
            }
            
            .message {
                max-width: 70%;
                padding: 15px;
            }
            
            .message-content {
                font-size: 1.2rem;
            }
            
            .input-area {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>能源顾问</h1>
        <p>基于DeepSeek API的智能能源助手</p>
        <div class="api-status">
            <div class="status-indicator status-connected" id="status-indicator"></div>
            <span id="status-text">API已连接</span>
        </div>
    </div>
    
    <div class="chat-container" id="chat-container">
        <div class="message assistant-message">
            <div class="message-header">
                <div class="avatar assistant-avatar">能</div>
                <div class="sender-name">能源顾问</div>
            </div>
            <div class="message-content">
                <p>您好！我是基于DeepSeek API的能源顾问，专注于为您提供2024年科学规范的全球能源数据和分析。</p>
                <div class="data-point">
                    • 全球能源消费结构<br>
                    • 化石能源可消耗年限<br>
                    • 主要能源消费占比<br>
                    • 可再生能源发展现状
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-area">
        <div class="input-container">
            <input type="text" id="user-input" placeholder="请输入关于能源的问题...">
            <button id="send-btn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        
        <div class="suggested-questions">
            <div class="question-chip" data-question="全球主要消费的能源是哪些？">全球主要消费的能源是哪些？</div>
            <div class="question-chip" data-question="全球能源还能消耗多久？">全球能源还能消耗多久？</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const questionChips = document.querySelectorAll('.question-chip');
            
            // 内置API密钥
            const apiKey = "sk-933023ccb170419b89f3b879299b8b1e";
            
            // 添加用户消息到对话
            function addUserMessage(message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="avatar user-avatar">我</div>
                        <div class="sender-name">用户</div>
                    </div>
                    <div class="message-content">${message}</div>
                `;
                chatContainer.appendChild(messageElement);
                userInput.value = '';
                
                // 确保消息完全显示
                setTimeout(() => {
                    scrollToBottom();
                }, 10);
                
                // 添加思考指示器
                addThinkingIndicator();
                
                // 调用DeepSeek API
                callDeepSeekAPI(message);
            }
            
            // 添加思考指示器
            function addThinkingIndicator() {
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                messageElement.id = 'thinking-indicator';
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="avatar assistant-avatar">能</div>
                        <div class="sender-name">能源顾问</div>
                    </div>
                    <div class="message-content thinking-indicator">
                        正在检索数据<span class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>
                    </div>
                `;
                chatContainer.appendChild(messageElement);
                setTimeout(() => {
                    scrollToBottom();
                }, 10);
            }
            
            // 移除思考指示器
            function removeThinkingIndicator() {
                const thinkingIndicator = document.getElementById('thinking-indicator');
                if (thinkingIndicator) {
                    thinkingIndicator.remove();
                }
            }
            
            // 调用DeepSeek API
            async function callDeepSeekAPI(userMessage) {
                try {
                    const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'system',
                                    content: `你是一个能源领域的专业顾问，专注于为用户提供准确、科学、规范的能源数据和分析。

重要要求：
1. 只提供2024年权威可信的全球数据，不提供国内外对比
2. 使用科学规范、精简的语言进行结构性回答
3. 专注于检索和整理相关权威数据信息
4. 不使用比喻、拟人等修辞手法
5. 提供结构清晰的回答，可以使用标题、列表和数据点
6. 引用权威数据来源和年份
7. 重点回答用户提出的具体问题，不添加无关内容
8. 精简显示内容，同一个回答里不要重复提供相同内容
9. 如果使用表格，确保表格格式正确，行列对齐，内容对应正确
10. 使用以下格式组织回答：
    - 使用标题和副标题划分内容
    - 使用列表呈现多个数据点
    - 使用表格对比数据
    - 使用粗体强调关键数据
    - 每个部分之间使用空行分隔`
                                },
                                {
                                    role: 'user',
                                    content: userMessage
                                }
                            ],
                            max_tokens: 1200, // 减少token数量以精简内容
                            temperature: 0.2 // 降低温度以提高确定性
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API请求失败: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    removeThinkingIndicator();
                    
                    if (data.choices && data.choices.length > 0) {
                        addAssistantMessage(data.choices[0].message.content);
                    } else {
                        addAssistantMessage('抱歉，我没有收到有效的回复。请稍后再试。');
                    }
                } catch (error) {
                    console.error('API调用错误:', error);
                    removeThinkingIndicator();
                    addAssistantMessage(`抱歉，发生了错误: ${error.message}。请稍后再试。`);
                }
            }
            
            // 添加助手消息到对话
            function addAssistantMessage(message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                
                // 格式化消息内容
                let formattedMessage = formatMessage(message);
                
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="avatar assistant-avatar">能</div>
                        <div class="sender-name">能源顾问</div>
                    </div>
                    <div class="message-content">${formattedMessage}</div>
                `;
                chatContainer.appendChild(messageElement);
                
                // 确保消息完全显示
                setTimeout(() => {
                    scrollToBottom();
                }, 10);
            }
            
            // 格式化消息内容 - 将Markdown转换为HTML
            function formatMessage(text) {
                // 替换换行符
                let formatted = text.replace(/\n/g, '<br>');
                
                // 替换标题
                formatted = formatted.replace(/### (.*?)<br>/g, '<h4>$1</h4>');
                formatted = formatted.replace(/## (.*?)<br>/g, '<h3>$1</h3>');
                
                // 替换列表项
                formatted = formatted.replace(/- (.*?)<br>/g, '<li>$1</li>');
                formatted = formatted.replace(/(<li>.*<\/li>(<br>)?)+/g, (match) => {
                    return '<ul>' + match.replace(/<br><li>/g, '<li>').replace(/<br><\/ul>/g, '</ul>') + '</ul>';
                });
                
                // 替换粗体
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // 替换表格 - 增强表格处理逻辑
                if (formatted.includes('|')) {
                    const lines = formatted.split('<br>');
                    let inTable = false;
                    let tableHTML = '';
                    
                    for (let i = 0; i < lines.length; i++) {
                        if (lines[i].includes('|') && !lines[i].startsWith('<')) {
                            if (!inTable) {
                                tableHTML = '<table>';
                                inTable = true;
                            }
                            
                            // 处理表头分隔线
                            if (lines[i].includes('---') || lines[i].includes(':-')) {
                                continue;
                            }
                            
                            const cells = lines[i].split('|').filter(cell => cell.trim() !== '');
                            let rowHTML = '<tr>';
                            
                            for (let j = 0; j < cells.length; j++) {
                                const cellContent = cells[j].trim();
                                const isHeader = (i === 0 || (i > 0 && (lines[i-1].includes('---') || lines[i-1].includes(':-'))));
                                rowHTML += isHeader ? `<th>${cellContent}</th>` : `<td>${cellContent}</td>`;
                            }
                            
                            rowHTML += '</tr>';
                            tableHTML += rowHTML;
                        } else if (inTable) {
                            tableHTML += '</table>';
                            lines[i] = tableHTML + '<br>' + lines[i];
                            inTable = false;
                            tableHTML = '';
                        }
                    }
                    
                    if (inTable) {
                        formatted = lines.join('<br>').replace(tableHTML, tableHTML + '</table>');
                    } else {
                        formatted = lines.join('<br>');
                    }
                }
                
                return formatted;
            }
            
            // 滚动到底部
            function scrollToBottom() {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // 发送消息
            sendBtn.addEventListener('click', function() {
                const message = userInput.value.trim();
                if (message) {
                    addUserMessage(message);
                }
            });
            
            // 按Enter发送消息
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const message = userInput.value.trim();
                    if (message) {
                        addUserMessage(message);
                    }
                }
            });
            
            // 建议问题点击
            questionChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    addUserMessage(question);
                });
            });
            
            // 初始滚动到底部
            setTimeout(() => {
                scrollToBottom();
            }, 100);
        });
    </script>
</body>
</html>